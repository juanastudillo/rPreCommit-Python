#!/usr/bin/env python3

import sys
import subprocess

# ---
# 1. Validación del mensaje del commit
# ---
COMMIT_MSG_FILE = ".git/COMMIT_EDITMSG"

try:
    with open(COMMIT_MSG_FILE, 'r') as f:
        commit_message = f.read().strip()
except FileNotFoundError:
    print("❌ ERROR: No se pudo encontrar el archivo del mensaje del commit.")
    sys.exit(1)

if "fix" in commit_message.lower():
    print("--------------------------------------------------------")
    print("❌ ¡ERROR! El commit ha sido cancelado.")
    print("No se permiten mensajes de commit que contengan la palabra 'fix'.")
    print("Por favor, utiliza un mensaje de commit diferente.")
    print("--------------------------------------------------------")
    sys.exit(1)

print("✅ El mensaje del commit es válido.")
print("---")

# ---
# 2. Ejecución del linter flake8
# ---
print("Ejecutando linter de Python (flake8)...")

# Ejecuta flake8 en los archivos modificados
result = subprocess.run(
    ["flake8", "--show-source", "--statistic"],
    capture_output=True, text=True
)

if result.returncode != 0:
    print("--------------------------------------------------------")
    print("❌ El linter encontró errores. El commit ha sido cancelado.")
    print(result.stdout)
    print("--------------------------------------------------------")
    sys.exit(1)

print("Linter finalizado. El código es correcto.")
sys.exit(0)
